# é”€å† åŸ¹å…»ç³»ç»Ÿ & ç¤¾æåŸ¹å…»ç³»ç»Ÿ

ä»“åº“åœ°å€ï¼š[https://github.com/shangyankeji/zhixun](https://github.com/shangyankeji/zhixun)

<div align="center">

<a href="https://qoder.ai">
  <img src="frontend/public/qoder-logo.png" alt="Qoder Logo" width="200" />
</a>

**Qoder åˆ›æ„æŒ‘æˆ˜ Â· ç¬¬ä¸€æœŸ**

> æœ¬é¡¹ç›®ç”± **Qoder ç¤¾åŒº** å°ä¼™ä¼´â€…@Janeâ€…æä¾›åˆ›æ„æƒ³æ³•ï¼Œç”±æˆ‘ä½¿ç”¨ **[Qoder](https://qoder.ai)** è¿›è¡ŒæŠ€æœ¯è½åœ°å¼€å‘ã€‚
> 
> è¿™æ˜¯ä¸€æ¬¡ **"ä»åˆ›æ„åˆ°ä»£ç "** çš„å®è·µï¼šç¤¾åŒºè´¡çŒ® ideaï¼Œç”±æˆ‘ä½¿ç”¨Qoderæ¥å¼€å‘æŠ€æœ¯è½åœ°ï¼Œå…±åŒæ‰“é€ çœŸæ­£å¯ç”¨çš„äº§å“ã€‚

---

**ğŸŒŸ 100% å¼€æº Â· å®Œå…¨å…è´¹ Â· å¯å•†ç”¨ ğŸŒŸ**

æœ¬é¡¹ç›®é‡‡ç”¨ **MIT åè®®** å¼€æºï¼Œä»»ä½•äººéƒ½å¯ä»¥è‡ªç”±ä½¿ç”¨ã€ä¿®æ”¹ã€åˆ†å‘ï¼ŒåŒ…æ‹¬å•†ä¸šç”¨é€”ã€‚  
æˆ‘ä»¬å¸Œæœ›è¿™ä¸ªé¡¹ç›®èƒ½å¸®åŠ©æ›´å¤šäººæå‡é”€å”®ä¸ç¤¾äº¤èƒ½åŠ›ï¼

---

**AI é©±åŠ¨çš„é”€å”®ä¸ç¤¾äº¤èƒ½åŠ›åŸ¹è®­å¹³å°**

åŸºäºå¤š Agent åä½œçš„åœºæ™¯æ¨¡æ‹Ÿè®­ç»ƒç³»ç»Ÿ

[![FastAPI](https://img.shields.io/badge/FastAPI-0.115+-009688?style=flat&logo=fastapi)](https://fastapi.tiangolo.com/)
[![Next.js](https://img.shields.io/badge/Next.js-16.1-000000?style=flat&logo=next.js)](https://nextjs.org/)
[![Python](https://img.shields.io/badge/Python-3.11+-3776AB?style=flat&logo=python)](https://www.python.org/)
[![TypeScript](https://img.shields.io/badge/TypeScript-5.0+-3178C6?style=flat&logo=typescript)](https://www.typescriptlang.org/)
[![License](https://img.shields.io/badge/License-MIT-blue.svg)](LICENSE)

</div>

---

## ç›®å½•

- [é¡¹ç›®ç®€ä»‹](#é¡¹ç›®ç®€ä»‹)
- [æ ¸å¿ƒç‰¹æ€§](#æ ¸å¿ƒç‰¹æ€§)
- [æŠ€æœ¯æ ˆ](#æŠ€æœ¯æ ˆ)
- [å¿«é€Ÿå¼€å§‹](#å¿«é€Ÿå¼€å§‹)
- [ç¯å¢ƒé…ç½®](#ç¯å¢ƒé…ç½®)
- [å¼€å‘æŒ‡å—](#å¼€å‘æŒ‡å—)
- [é¡¹ç›®æ¶æ„](#é¡¹ç›®æ¶æ„)
- [API æ–‡æ¡£](#api-æ–‡æ¡£)
- [éƒ¨ç½²æŒ‡å—](#éƒ¨ç½²æŒ‡å—)
- [Docker ä¸€é”®éƒ¨ç½²](#æ–¹å¼ä¸€docker-ä¸€é”®éƒ¨ç½²-æ¨è)
- [æ‰‹åŠ¨éƒ¨ç½²](#æ–¹å¼äºŒé-docker-æ‰‹åŠ¨éƒ¨ç½²)
- [CDN éƒ¨ç½²](#æ–¹å¼ä¸‰cdn-éƒ¨ç½²-edgeonecloudflare)
- [å¸¸è§é—®é¢˜](#å¸¸è§é—®é¢˜)
- [è´¡çŒ®æŒ‡å—](#è´¡çŒ®æŒ‡å—)
- [å¼€æºåè®®](#å¼€æºåè®®)

---

## é¡¹ç›®ç®€ä»‹

**é”€å† åŸ¹å…»ç³»ç»Ÿ (SCS - Sales Champion System)** å’Œ **ç¤¾æåŸ¹å…»ç³»ç»Ÿ (SCC - Social Confidence Cultivator)** æ˜¯ä¸€å¥—åŸºäº AI å¤š Agent åä½œçš„èƒ½åŠ›åŸ¹è®­å¹³å°ã€‚

### äº§å“å®šä½

- **SCS (é”€å† åŸ¹å…»ç³»ç»Ÿ)**: é¢å‘é”€å”®äººå‘˜/ç»„ç»‡çš„å®æˆ˜æ¨¡æ‹Ÿè®­ç»ƒè¥ï¼Œæä¾›ç”µè¯é‚€çº¦ã€éœ€æ±‚æŒ–æ˜ã€å¼‚è®®å¤„ç†ã€è°ˆåˆ¤æŠ€å·§ç­‰åœºæ™¯åŒ–è®­ç»ƒ
- **SCC (ç¤¾æåŸ¹å…»ç³»ç»Ÿ)**: é¢å‘èŒåœºäººç¾¤/ç¤¾äº¤ç„¦è™‘è€…çš„å®‰å…¨é™ªç»ƒç³»ç»Ÿï¼Œæä¾›é™Œç”Ÿç¤¾äº¤ã€ä¼šè®®å‘è¨€ã€å†²çªå¤„ç†ç­‰é˜¶æ¢¯å¼è®­ç»ƒ

### æ ¸å¿ƒä»·å€¼

- **å¯æ§**: å¯¼æ¼” Agent å¯è°ƒéš¾åº¦ã€æ³¨å…¥äº‹ä»¶ã€æ§åˆ¶å¯¹è¯èŠ‚å¥
- **å¯æ¯”**: å›ºå®šç§å­çš„æµ‹è¯„æ¨¡å¼ï¼Œæ”¯æŒè®­ç»ƒå‰åå¯¹æ¯”
- **å¯è¿½æº¯**: è¯„åˆ†å¼•ç”¨è¯æ®å¥ï¼Œä¼šè¯å®Œæ•´å¯å›æ”¾
- **å¯æ²‰æµ¸**: å®æ—¶è¯­éŸ³å¯¹è¯ï¼Œæ”¯æŒæ‰“æ–­ä¸æ–­çº¿é‡è¿
- **å¯è¿è¥**: åœºæ™¯èµ„äº§åŒ–ï¼Œåå°å¯ç¼–è¾‘ã€æŠ•æ”¾ã€ç°åº¦å‘å¸ƒ

---

## æ ¸å¿ƒç‰¹æ€§

### 1. å¤š Agent åä½œå¼•æ“

- **Director Agent (å¯¼æ¼”)**: åœºæ™¯ç¼–æ’ã€éš¾åº¦æ§åˆ¶ã€äº‹ä»¶æ³¨å…¥
- **NPC Agent (è§’è‰²)**: æ¨¡æ‹Ÿå®¢æˆ·ã€æœ‹å‹ã€åŒäº‹ç­‰å¯¹è¯è§’è‰²
- **Evaluator Agent (è¯„ä¼°å¸ˆ)**: å®æ—¶è¯„ä¼°ç”¨æˆ·è¡¨ç°ï¼Œç”Ÿæˆé‡åŒ–è¯„åˆ†
- **Coach Agent (æ•™ç»ƒ)**: æä¾›ä¸ªæ€§åŒ–å­¦ä¹ å»ºè®®å’Œæ”¹è¿›æ–¹å‘
- **Safety Agent (å®‰å…¨æ£€æŸ¥)**: å†…å®¹å®‰å…¨è¿‡æ»¤å’Œåˆè§„æ£€æŸ¥
- **Memory Agent (è®°å¿†ç®¡ç†)**: è·¨ä¼šè¯è®°å¿†å’Œä¸Šä¸‹æ–‡ç®¡ç†

### 2. ä¸‰å¤§è®­ç»ƒæ¨¡å¼

- **Train (è®­ç»ƒæ¨¡å¼)**: åˆ»æ„ç»ƒä¹ ï¼Œæ”¯æŒæš‚åœã€æç¤ºã€å›æ”¾
- **Exam (æµ‹è¯„æ¨¡å¼)**: å›ºå®šåœºæ™¯è¯„ä¼°ï¼Œç”Ÿæˆé‡åŒ–æŠ¥å‘Š
- **Replay (å¤ç›˜æ¨¡å¼)**: å›æ”¾å†å²ä¼šè¯ï¼Œå¯¹æ¯”æ”¹è¿›è½¨è¿¹

### 3. å®æ—¶è¯­éŸ³å¯¹è¯

- åŸºäºé˜¿é‡Œäº‘ Qwen-Omni-Realtime æ¨¡å‹
- WebSocket å®æ—¶é€šä¿¡ï¼Œä½å»¶è¿Ÿå“åº”
- VAD (è¯­éŸ³æ´»åŠ¨æ£€æµ‹) è‡ªåŠ¨è§¦å‘
- æ”¯æŒå¯¹è¯æ‰“æ–­å’Œæ–­çº¿é‡è¿

### 4. æ™ºèƒ½è®­ç»ƒè®¡åˆ’

- ä¸ªæ€§åŒ–è®­ç»ƒè®¡åˆ’ç”Ÿæˆ
- è‡ªé€‚åº”éš¾åº¦è°ƒæ•´
- å­¦ä¹ è¿›åº¦è·Ÿè¸ª
- èƒ½åŠ›é›·è¾¾å›¾å¯è§†åŒ–

### 5. è¯¾ç¨‹ä¸ç¤¾åŒº

- ç»“æ„åŒ–è¯¾ç¨‹ä½“ç³» (é”€å”®èµ‹èƒ½/ç¤¾äº¤æŠ€èƒ½)
- ç”¨æˆ·åŠ¨æ€åˆ†äº«
- æ’è¡Œæ¦œä¸æŒ‘æˆ˜èµ›
- å­¦ä¹ æˆå°±ç³»ç»Ÿ

### 6. åå°ç®¡ç†ç³»ç»Ÿ

- æ•°æ®æ¦‚è§ˆ (å®æ—¶æŒ‡æ ‡ã€å¢é•¿è¶‹åŠ¿å›¾è¡¨)
- ç”¨æˆ·ç®¡ç†ä¸æƒé™æ§åˆ¶
- åœºæ™¯ç¼–è¾‘ä¸ç‰ˆæœ¬ç®¡ç†
- å¹¿åœºå®¡æ ¸ (åœºæ™¯å‘å¸ƒå®¡æ ¸)
- è¯¾ç¨‹å†…å®¹ç®¡ç†
- ç¤¾åŒºç®¡ç† (åŠ¨æ€å®¡æ ¸)
- è®­ç»ƒæŠ¥å‘Šç»Ÿè®¡
- è®­ç»ƒè®¡åˆ’ç®¡ç†
- æˆå°±å‹‹ç« é…ç½®
- é€šçŸ¥ç®¡ç†

### 7. VIPä¼šå‘˜ç³»ç»Ÿ

- VIPå¥—é¤ç®¡ç† (åˆ›å»º/ç¼–è¾‘/åˆ é™¤/å¯ç”¨ç¦ç”¨)
- å¤šç§è®¡è´¹å‘¨æœŸ (æœˆä»˜/å­£ä»˜/åŠå¹´ä»˜/å¹´ä»˜)
- ä¼šå‘˜æƒç›Šé…ç½® (åœºæ™¯æ•°é‡ã€è¯­éŸ³æ—¶é•¿ã€ä¸“å±åŠŸèƒ½)
- è®¢å•ç®¡ç† (æŸ¥çœ‹/æœç´¢/çŠ¶æ€ç®¡ç†)
- ä¼šå‘˜è®¢é˜…ä¸ç»­è´¹

### 8. è¥é”€ç³»ç»Ÿ

- ä¼˜æƒ åˆ¸ç®¡ç† (åˆ›å»º/å‘æ”¾/æ ¸é”€)
- å…‘æ¢ç ç³»ç»Ÿ (æ‰¹é‡ç”Ÿæˆ/å…‘æ¢/ç»Ÿè®¡)
- æ¨å¹¿é‚€è¯· (é‚€è¯·ç /å¥–åŠ±é…ç½®)
- ç§¯åˆ†ç³»ç»Ÿ (è·å–è§„åˆ™/æ¶ˆè€—è§„åˆ™/ç­‰çº§é…ç½®)

### 9. ç³»ç»Ÿé…ç½®

- åŸºç¡€è®¾ç½® (ç«™ç‚¹åç§°/Logo/è”ç³»æ–¹å¼)
- çŸ­ä¿¡é…ç½® (é˜¿é‡Œäº‘çŸ­ä¿¡/æ¨¡æ¿ç®¡ç†)
- ç™»å½•é…ç½® (ç™»å½•æ–¹å¼/å®‰å…¨ç­–ç•¥)
- æ”¯ä»˜é…ç½® (å¾®ä¿¡æ”¯ä»˜/æ”¯ä»˜å®)
- ç§¯åˆ†é…ç½® (ç§¯åˆ†è§„åˆ™/ç­‰çº§è®¾ç½®)
- ç­¾åˆ°é…ç½® (åŸºç¡€å¥–åŠ±/è¿ç»­ç­¾åˆ°å¥–åŠ±)

### 10. ç™»å½•å®‰å…¨å¢å¼º

- ç™»å½•å¤±è´¥é™æµ (5/10/20æ¬¡ -> 15åˆ†é’Ÿ/1å°æ—¶/24å°æ—¶é”å®š)
- IPçº§åˆ«é™æµ (æ¯åˆ†é’Ÿ10æ¬¡è¯·æ±‚)
- Tokené»‘åå• (æ”¯æŒå¼ºåˆ¶ç™»å‡º)
- ç™»å½•å†å²è®°å½• (IPã€è®¾å¤‡ã€æµè§ˆå™¨ã€æ“ä½œç³»ç»Ÿ)
- JWTå¢å¼º (jtiå”¯ä¸€æ ‡è¯†ã€iatç­¾å‘æ—¶é—´)
- æ™ºèƒ½401å¤„ç† (åªæœ‰æ ¸å¿ƒè®¤è¯ç«¯ç‚¹å¤±è´¥æ‰å¼ºåˆ¶ç™»å‡º)

### 11. ç¬¬ä¸‰æ–¹ç™»å½•

- å¾®ä¿¡æ‰«ç ç™»å½• (PCç«¯)
- å¾®ä¿¡å…¬ä¼—å·ç½‘é¡µæˆæƒ (ç§»åŠ¨ç«¯å¾®ä¿¡å†…)
- è‡ªåŠ¨æ³¨å†Œæ–°ç”¨æˆ·
- è´¦å·ç»‘å®š/è§£ç»‘

### 12. è®­ç»ƒå¹¿åœº

- åœºæ™¯åˆ†äº«ä¸å‘å¸ƒ
- ç‚¹èµã€æ”¶è—ã€ForkåŠŸèƒ½
- çƒ­é—¨åœºæ™¯æ¨è
- åœºæ™¯æœç´¢ä¸ç­›é€‰
- åˆ›ä½œè€…ä¸»é¡µ
- æ¯æ—¥ç­¾åˆ° (ç§¯åˆ†å¥–åŠ±ã€è¿ç»­ç­¾åˆ°åŠ æˆ)

### 13. ç§¯åˆ†ç³»ç»Ÿ

- å¤šç§ç§¯åˆ†è·å–æ–¹å¼ (ç­¾åˆ°ã€è®­ç»ƒã€åˆ†äº«ã€é‚€è¯·)
- ç§¯åˆ†æ¶ˆè€— (å…‘æ¢VIPã€è§£é”åœºæ™¯)
- ç§¯åˆ†ç­‰çº§ä½“ç³»
- ç§¯åˆ†æ˜ç»†è®°å½•

### 14. UI/UX ä¼˜åŒ–

- å•†ä¸šçº§Toastæç¤ºç³»ç»Ÿ (success/error/warning/info)
- ç»Ÿä¸€é”™è¯¯å¤„ç†æœºåˆ¶
- æ·±è‰²/æµ…è‰²ä¸»é¢˜é…è‰²ä¼˜åŒ– (çº¯é»‘/çº¯ç™½åŸºè°ƒ)
- é«˜å¯¹æ¯”åº¦æ–‡å­— (WCAG AAAæ ‡å‡†)
- ç»Ÿä¸€å“ç‰Œæ¸å˜è‰²å½©
- ä¼˜é›…çš„åŠ¨ç”»æ•ˆæœ (Framer Motion)

---

## æŠ€æœ¯æ ˆ

### åç«¯

- **æ¡†æ¶**: FastAPI 0.115+ (å¼‚æ­¥é«˜æ€§èƒ½)
- **è¯­è¨€**: Python 3.11+
- **æ•°æ®åº“**: PostgreSQL 16 (ä¸»æ•°æ®åº“) + Redis 7 (ç¼“å­˜/é˜Ÿåˆ—)
- **ORM**: SQLAlchemy 2.0 (AsyncIO)
- **è¿ç§»**: Alembic
- **ä»»åŠ¡é˜Ÿåˆ—**: Celery (å¯é€‰)
- **AI æ¨¡å‹**: é˜¿é‡Œäº‘ç™¾ç‚¼ (DashScope) - é€šä¹‰åƒé—®ç³»åˆ—
- **æ—¥å¿—**: structlog (ç»“æ„åŒ–æ—¥å¿—)

### å‰ç«¯

- **æ¡†æ¶**: Next.js 16.1 (App Router)
- **UI åº“**: React 19.2
- **è¯­è¨€**: TypeScript 5.0+
- **æ ·å¼**: Tailwind CSS 4
- **çŠ¶æ€ç®¡ç†**: Zustand (æŒä¹…åŒ–å­˜å‚¨)
- **å›¾æ ‡**: Lucide React
- **å›¾è¡¨**: Recharts
- **è¡¨å•**: React Hook Form + Zod
- **HTTP å®¢æˆ·ç«¯**: Axios + TanStack Query

### DevOps

- **å®¹å™¨åŒ–**: Docker + Docker Compose
- **ä»£ç è§„èŒƒ**: Ruff (Python) + ESLint (TypeScript)
- **æµ‹è¯•**: Pytest (åç«¯) + Jest (å‰ç«¯)
- **ç±»å‹æ£€æŸ¥**: Mypy (Python) + TypeScript

---

## å¿«é€Ÿå¼€å§‹

### å‰ç½®è¦æ±‚

- **Node.js**: 20.x æˆ–æ›´é«˜ç‰ˆæœ¬
- **Python**: 3.11 æˆ–æ›´é«˜ç‰ˆæœ¬
- **Docker**: æœ€æ–°ç‰ˆæœ¬ (ç”¨äºè¿è¡Œ PostgreSQL å’Œ Redis)
- **é˜¿é‡Œäº‘ç™¾ç‚¼ API Key**: [è·å–åœ°å€](https://bailian.console.aliyun.com/#/api-key)

### ä¸€é”®å¯åŠ¨ (æ¨è)

```bash
# 1. å…‹éš†é¡¹ç›®
git clone <repository-url>
cd xiaoshou

# 2. é…ç½®ç¯å¢ƒå˜é‡
cp .env.example .env
# ç¼–è¾‘ .env æ–‡ä»¶ï¼Œå¡«å†™ DASHSCOPE_API_KEY

# 3. å¯åŠ¨æ•°æ®åº“
make db

# 4. å®‰è£…ä¾èµ–
make install

# 5. è¿è¡Œæ•°æ®åº“è¿ç§»
make migrate

# 6. åœ¨æ–°ç»ˆç«¯å¯åŠ¨åç«¯
make backend

# 7. åœ¨æ–°ç»ˆç«¯å¯åŠ¨å‰ç«¯
make frontend
```

### è®¿é—®åº”ç”¨

- **å‰ç«¯**: http://localhost:8110
- **åç«¯ API**: http://localhost:8111
- **API æ–‡æ¡£**: http://localhost:8111/docs (Swagger UI)
- **å¤‡ç”¨æ–‡æ¡£**: http://localhost:8111/redoc (ReDoc)

### é»˜è®¤ç®¡ç†å‘˜è´¦å·

é¦–æ¬¡å¯åŠ¨åï¼Œè¿è¡Œä»¥ä¸‹å‘½ä»¤åˆå§‹åŒ–æ•°æ®åº“ï¼ˆåˆ›å»ºè¡¨ç»“æ„ + ç®¡ç†å‘˜è´¦å· + 30ä¸ªé»˜è®¤åœºæ™¯ï¼‰ï¼š

```bash
./deploy.sh init-db
```

**é»˜è®¤ç®¡ç†å‘˜è´¦å·ï¼š**
```
æ‰‹æœºå·: 13800000000
å¯†ç :   admin123
```

**é‡è¦**: ç”Ÿäº§ç¯å¢ƒè¯·ç«‹å³ä¿®æ”¹é»˜è®¤å¯†ç ï¼

---

## ç¯å¢ƒé…ç½®

### åç«¯ç¯å¢ƒå˜é‡

åˆ›å»º `backend/.env` æ–‡ä»¶ (å‚è€ƒ `.env.example`):

```bash
# åº”ç”¨é…ç½®
APP_ENV=development
DEBUG=true

# æ•°æ®åº“ (å¼€å‘ç¯å¢ƒä½¿ç”¨ Docker æ˜ å°„ç«¯å£ 8108/8109)
DATABASE_URL=postgresql+asyncpg://postgres:postgres@localhost:8108/asp_db
REDIS_URL=redis://localhost:8109/0

# JWT è®¤è¯
JWT_SECRET=your-super-secret-key-change-in-production
JWT_EXPIRE_MINUTES=1440

# é˜¿é‡Œäº‘ç™¾ç‚¼ (å¿…å¡«)
DASHSCOPE_API_KEY=sk-xxx
DASHSCOPE_MODEL=qwen3-max
DASHSCOPE_REGION=beijing

# å®æ—¶è¯­éŸ³å¯¹è¯
REALTIME_MODEL=qwen3-omni-flash-realtime
REALTIME_VOICE=Cherry

# å¾®ä¿¡ç™»å½• (å¯é€‰)
WECHAT_APP_ID=
WECHAT_APP_SECRET=
WECHAT_REDIRECT_URI=http://localhost:8110/api/v1/auth/wechat/callback
WECHAT_MP_APP_ID=
WECHAT_MP_APP_SECRET=
```

### å‰ç«¯ç¯å¢ƒå˜é‡

åˆ›å»º `frontend/.env.local` æ–‡ä»¶:

```bash
NEXT_PUBLIC_API_URL=http://localhost:8111/api/v1
```

### å›½å†…é•œåƒæºé…ç½® (å¯é€‰)

```bash
# npm ä½¿ç”¨æ·˜å®é•œåƒ
npm config set registry https://registry.npmmirror.com

# pip ä½¿ç”¨æ¸…åé•œåƒ
pip config set global.index-url https://pypi.tuna.tsinghua.edu.cn/simple
```

---

## å¼€å‘æŒ‡å—

### å¼€å‘å‘½ä»¤

```bash
# å¯åŠ¨æ•°æ®åº“ (PostgreSQL + Redis)
make db

# å¯åŠ¨åç«¯å¼€å‘æœåŠ¡å™¨ (çƒ­é‡è½½)
make backend

# å¯åŠ¨å‰ç«¯å¼€å‘æœåŠ¡å™¨ (çƒ­é‡è½½)
make frontend

# è¿è¡Œæ•°æ®åº“è¿ç§»
make migrate

# åˆ›å»ºæ–°è¿ç§»æ–‡ä»¶
make migrate-new

# è¿è¡Œæµ‹è¯•
make test

# ä»£ç æ£€æŸ¥ (Linter)
make lint

# ä»£ç æ ¼å¼åŒ–
make format

# æ¸…ç†ä¸´æ—¶æ–‡ä»¶
make clean

# åœæ­¢æ‰€æœ‰æœåŠ¡
make stop
```

### å•ç‹¬è¿è¡Œåç«¯

```bash
cd backend

# åˆ›å»ºè™šæ‹Ÿç¯å¢ƒ
python -m venv .venv
source .venv/bin/activate  # Windows: .venv\Scripts\activate

# å®‰è£…ä¾èµ–
pip install -r requirements-dev.txt

# è¿è¡Œè¿ç§»
alembic upgrade head

# å¯åŠ¨å¼€å‘æœåŠ¡å™¨
uvicorn app.main:app --reload --host 0.0.0.0 --port 8111
```

### å•ç‹¬è¿è¡Œå‰ç«¯

```bash
cd frontend

# å®‰è£…ä¾èµ–
npm install

# å¯åŠ¨å¼€å‘æœåŠ¡å™¨
npm run dev

# æ„å»ºç”Ÿäº§ç‰ˆæœ¬
npm run build

# è¿è¡Œç”Ÿäº§ç‰ˆæœ¬
npm run start
```

### æ•°æ®åº“ç®¡ç†

```bash
# åˆ›å»ºæ–°è¿ç§»
cd backend
source .venv/bin/activate
alembic revision --autogenerate -m "æè¿°ä¿¡æ¯"

# åº”ç”¨è¿ç§»
alembic upgrade head

# å›æ»šè¿ç§»
alembic downgrade -1

# æŸ¥çœ‹è¿ç§»å†å²
alembic history
```

### æµ‹è¯•

```bash
# è¿è¡Œåç«¯æµ‹è¯•
cd backend
source .venv/bin/activate
pytest -v

# è¿è¡Œæµ‹è¯•å¹¶ç”Ÿæˆè¦†ç›–ç‡æŠ¥å‘Š
pytest --cov=app --cov-report=html

# è¿è¡Œç‰¹å®šæµ‹è¯•æ–‡ä»¶
pytest tests/test_agents/test_npc.py -v
```

---

## é¡¹ç›®æ¶æ„

### åç«¯æ¶æ„

```
backend/
â”œâ”€â”€ app/
â”‚   â”œâ”€â”€ main.py              # FastAPI åº”ç”¨å…¥å£
â”‚   â”œâ”€â”€ config.py            # é…ç½®ç®¡ç† (Pydantic Settings)
â”‚   â”œâ”€â”€ api/
â”‚   â”‚   â”œâ”€â”€ deps.py          # ä¾èµ–æ³¨å…¥
â”‚   â”‚   â””â”€â”€ v1/              # API v1 è·¯ç”±
â”‚   â”‚       â”œâ”€â”€ auth.py      # è®¤è¯ç›¸å…³ (ç™»å½•/æ³¨å†Œ/å¾®ä¿¡ç™»å½•)
â”‚   â”‚       â”œâ”€â”€ users.py     # ç”¨æˆ·ç®¡ç†
â”‚   â”‚       â”œâ”€â”€ courses.py   # è¯¾ç¨‹ç®¡ç†
â”‚   â”‚       â”œâ”€â”€ scenarios.py # åœºæ™¯ç®¡ç†
â”‚   â”‚       â”œâ”€â”€ sessions.py  # è®­ç»ƒä¼šè¯
â”‚   â”‚       â”œâ”€â”€ realtime.py  # å®æ—¶è¯­éŸ³ (WebSocket)
â”‚   â”‚       â”œâ”€â”€ community.py # ç¤¾åŒºåŠŸèƒ½
â”‚   â”‚       â”œâ”€â”€ plaza.py     # è®­ç»ƒå¹¿åœº
â”‚   â”‚       â”œâ”€â”€ points.py    # ç§¯åˆ†ç³»ç»Ÿ
â”‚   â”‚       â”œâ”€â”€ checkin.py   # ç­¾åˆ°ç³»ç»Ÿ
â”‚   â”‚       â”œâ”€â”€ vip.py       # VIPä¼šå‘˜
â”‚   â”‚       â”œâ”€â”€ orders.py    # è®¢å•ç®¡ç†
â”‚   â”‚       â”œâ”€â”€ coupons.py   # ä¼˜æƒ åˆ¸
â”‚   â”‚       â”œâ”€â”€ redeem.py    # å…‘æ¢ç 
â”‚   â”‚       â””â”€â”€ admin.py     # åå°ç®¡ç†
â”‚   â”œâ”€â”€ models/              # SQLAlchemy æ•°æ®åº“æ¨¡å‹
â”‚   â”‚   â”œâ”€â”€ user.py          # ç”¨æˆ·æ¨¡å‹
â”‚   â”‚   â”œâ”€â”€ vip_level.py     # VIPç­‰çº§æ¨¡å‹
â”‚   â”‚   â”œâ”€â”€ order.py         # è®¢å•æ¨¡å‹
â”‚   â”‚   â”œâ”€â”€ coupon.py        # ä¼˜æƒ åˆ¸æ¨¡å‹
â”‚   â”‚   â”œâ”€â”€ redeem_code.py   # å…‘æ¢ç æ¨¡å‹
â”‚   â”‚   â”œâ”€â”€ points.py        # ç§¯åˆ†æ¨¡å‹
â”‚   â”‚   â””â”€â”€ ...
â”‚   â”œâ”€â”€ schemas/             # Pydantic æ•°æ®æ¨¡å‹ (è¯·æ±‚/å“åº”)
â”‚   â”œâ”€â”€ services/            # ä¸šåŠ¡é€»è¾‘å±‚
â”‚   â”‚   â”œâ”€â”€ user_service.py
â”‚   â”‚   â”œâ”€â”€ vip_service.py
â”‚   â”‚   â”œâ”€â”€ order_service.py
â”‚   â”‚   â”œâ”€â”€ coupon_service.py
â”‚   â”‚   â”œâ”€â”€ redeem_code_service.py
â”‚   â”‚   â”œâ”€â”€ points_service.py
â”‚   â”‚   â”œâ”€â”€ checkin_service.py
â”‚   â”‚   â””â”€â”€ ...
â”‚   â”œâ”€â”€ agents/              # AI Agent å®ç°
â”‚   â”‚   â”œâ”€â”€ base.py          # Agent åŸºç±»
â”‚   â”‚   â”œâ”€â”€ director.py      # å¯¼æ¼” Agent
â”‚   â”‚   â”œâ”€â”€ npc.py           # NPC Agent
â”‚   â”‚   â”œâ”€â”€ evaluator.py     # è¯„ä¼° Agent
â”‚   â”‚   â”œâ”€â”€ coach.py         # æ•™ç»ƒ Agent
â”‚   â”‚   â”œâ”€â”€ orchestrator.py  # Agent åè°ƒå™¨
â”‚   â”‚   â”œâ”€â”€ safety.py        # å®‰å…¨æ£€æŸ¥
â”‚   â”‚   â””â”€â”€ memory.py        # è®°å¿†ç®¡ç†
â”‚   â”œâ”€â”€ providers/           # å¤–éƒ¨æœåŠ¡æä¾›è€…
â”‚   â”‚   â””â”€â”€ llm/             # LLM æä¾›è€… (DashScope)
â”‚   â”œâ”€â”€ core/                # æ ¸å¿ƒåŠŸèƒ½
â”‚   â”‚   â”œâ”€â”€ security.py      # JWT è®¤è¯
â”‚   â”‚   â”œâ”€â”€ middleware.py    # ä¸­é—´ä»¶
â”‚   â”‚   â””â”€â”€ exceptions.py    # å¼‚å¸¸å¤„ç†
â”‚   â””â”€â”€ db/                  # æ•°æ®åº“è¿æ¥
â”œâ”€â”€ alembic/                 # æ•°æ®åº“è¿ç§»
â”œâ”€â”€ scripts/                 # è„šæœ¬å·¥å…·
â”‚   â”œâ”€â”€ seed_data.py         # åŸºç¡€æ•°æ®åˆå§‹åŒ–
â”‚   â”œâ”€â”€ seed_scenarios_full.py # åœºæ™¯æ•°æ®åˆå§‹åŒ–
â”‚   â””â”€â”€ seed_all.py          # å®Œæ•´æ•°æ®åˆå§‹åŒ–
â”œâ”€â”€ tests/                   # æµ‹è¯•æ–‡ä»¶
â””â”€â”€ requirements.txt         # ä¾èµ–åˆ—è¡¨
```

### å‰ç«¯æ¶æ„

```
frontend/src/
â”œâ”€â”€ app/                     # Next.js App Router
â”‚   â”œâ”€â”€ layout.tsx           # å…¨å±€å¸ƒå±€
â”‚   â”œâ”€â”€ (public)/            # å…¬å¼€é¡µé¢ (ç™»å½•ã€æ³¨å†Œ)
â”‚   â”œâ”€â”€ (main)/              # ä¸»åº”ç”¨ (éœ€è®¤è¯)
â”‚   â”‚   â”œâ”€â”€ dashboard/       # ä»ªè¡¨ç›˜
â”‚   â”‚   â”œâ”€â”€ courses/         # è¯¾ç¨‹ä¸­å¿ƒ
â”‚   â”‚   â””â”€â”€ community/       # ç¤¾åŒºå¹¿åœº
â”‚   â”œâ”€â”€ admin/               # åå°ç®¡ç†
â”‚   â””â”€â”€ training/            # è®­ç»ƒé¡µé¢
â”‚       â””â”€â”€ [id]/
â”‚           â”œâ”€â”€ page.tsx     # æ–‡å­—å¯¹è¯
â”‚           â””â”€â”€ voice/       # è¯­éŸ³å¯¹è¯
â”œâ”€â”€ components/              # React ç»„ä»¶
â”‚   â”œâ”€â”€ ui/                  # åŸºç¡€ UI ç»„ä»¶
â”‚   â”œâ”€â”€ admin/               # åå°ç®¡ç†ç»„ä»¶
â”‚   â””â”€â”€ charts/              # å›¾è¡¨ç»„ä»¶
â”œâ”€â”€ lib/
â”‚   â”œâ”€â”€ api.ts               # API å®¢æˆ·ç«¯
â”‚   â””â”€â”€ utils.ts             # å·¥å…·å‡½æ•°
â”œâ”€â”€ stores/                  # Zustand çŠ¶æ€ç®¡ç†
â”‚   â””â”€â”€ authStore.ts         # è®¤è¯çŠ¶æ€
â”œâ”€â”€ hooks/                   # è‡ªå®šä¹‰ Hooks
â””â”€â”€ types/                   # TypeScript ç±»å‹
```

### å¤š Agent åä½œæµç¨‹

```
ç”¨æˆ·è¾“å…¥
    â†“
[Safety Agent] â† å†…å®¹å®‰å…¨æ£€æŸ¥
    â†“
[Director Agent] â† åœºæ™¯ç¼–æ’ã€äº‹ä»¶æ³¨å…¥
    â†“
[NPC Agent] â† ç”Ÿæˆè§’è‰²å›å¤
    â†“
[Evaluator Agent] â† è¯„ä¼°ç”¨æˆ·è¡¨ç°
    â†“
[Coach Agent] â† ç”Ÿæˆå­¦ä¹ å»ºè®®
    â†“
[Memory Agent] â† è®°å¿†å­˜å‚¨
    â†“
è¿”å›ç»™ç”¨æˆ·
```

---

## API æ–‡æ¡£

### è®¤è¯ç›¸å…³

```bash
# ç”¨æˆ·æ³¨å†Œ
POST /api/v1/auth/register
Content-Type: application/json
{
  "phone": "13800138000",
  "password": "password123",
  "nickname": "å¼ ä¸‰",
  "track": "sales"  # æˆ– "social"
}

# ç”¨æˆ·ç™»å½•
POST /api/v1/auth/login
Content-Type: application/json
{
  "phone": "13800138000",
  "password": "password123"
}

# å“åº”
{
  "access_token": "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9...",
  "token_type": "bearer",
  "user": {
    "id": "uuid",
    "phone": "13800138000",
    "nickname": "å¼ ä¸‰",
    "track": "sales",
    "role": "user"
  }
}

# å¾®ä¿¡ç™»å½• - è·å–æˆæƒURL
GET /api/v1/auth/wechat/login-url?redirect_url=/dashboard&use_mp=false

# å“åº”
{
  "authorize_url": "https://open.weixin.qq.com/connect/qrconnect?...",
  "state": "abc123..."
}

# å¾®ä¿¡ç™»å½• - æ£€æŸ¥é…ç½®çŠ¶æ€
GET /api/v1/auth/wechat/config

# å“åº”
{
  "wechat_enabled": true,
  "wechat_mp_enabled": false
}
```

### ä¼šè¯ç®¡ç†

```bash
# åˆ›å»ºè®­ç»ƒä¼šè¯
POST /api/v1/sessions
Authorization: Bearer <token>
Content-Type: application/json
{
  "scenario_id": "uuid",
  "mode": "train"  # train/exam/replay
}

# å‘é€æ¶ˆæ¯
POST /api/v1/sessions/{session_id}/message
Authorization: Bearer <token>
Content-Type: application/json
{
  "content": "ä½ å¥½ï¼Œæˆ‘æƒ³äº†è§£ä¸€ä¸‹ä½ ä»¬çš„äº§å“"
}

# å®æ—¶è¯­éŸ³å¯¹è¯ (WebSocket)
WS /api/v1/realtime/{session_id}
```

### å®Œæ•´ API æ–‡æ¡£

å¯åŠ¨åç«¯æœåŠ¡åè®¿é—®:
- Swagger UI: http://localhost:8111/docs
- ReDoc: http://localhost:8111/redoc

---

## éƒ¨ç½²æŒ‡å—

### æ–¹å¼ä¸€ï¼šDocker ä¸€é”®éƒ¨ç½² (æ¨è)

é€‚åˆå¿«é€Ÿéƒ¨ç½²å’Œç”Ÿäº§ç¯å¢ƒï¼Œæ— éœ€æ‰‹åŠ¨é…ç½®ä¾èµ–ã€‚

```bash
# 1. å…‹éš†é¡¹ç›®
git clone <repository-url>
cd xiaoshou

# 2. é…ç½®ç¯å¢ƒå˜é‡
cp .env.production.example .env
# ç¼–è¾‘ .env æ–‡ä»¶ï¼Œå¡«å†™å¿…è¦çš„é…ç½®ï¼ˆç‰¹åˆ«æ˜¯ DASHSCOPE_API_KEYï¼‰

# 3. å®Œæ•´éƒ¨ç½²ï¼ˆé¦–æ¬¡å®‰è£…ï¼‰
./deploy.sh full-deploy
```

**éƒ¨ç½²è„šæœ¬å‘½ä»¤è¯´æ˜ï¼š**

| å‘½ä»¤ | è¯´æ˜ |
|------|------|
| `./deploy.sh start` | å¯åŠ¨æœåŠ¡ï¼ˆé»˜è®¤ï¼‰ |
| `./deploy.sh stop` | åœæ­¢æœåŠ¡ |
| `./deploy.sh restart` | é‡å¯æœåŠ¡ |
| `./deploy.sh rebuild` | é‡æ–°æ„å»ºé•œåƒå¹¶å¯åŠ¨ |
| `./deploy.sh init-db` | åˆå§‹åŒ–æ•°æ®åº“ï¼ˆåˆ›å»ºè¡¨+ç®¡ç†å‘˜+30ä¸ªåœºæ™¯ï¼‰ |
| `./deploy.sh upgrade` | æ›´æ–°éƒ¨ç½²ï¼ˆä»£ç æ›´æ–°åä½¿ç”¨ï¼‰ |
| `./deploy.sh full-deploy` | å®Œæ•´éƒ¨ç½²ï¼ˆé¦–æ¬¡å®‰è£…ä¸€é”®å®Œæˆï¼‰ |
| `./deploy.sh logs` | æŸ¥çœ‹æœåŠ¡æ—¥å¿— |
| `./deploy.sh status` | æŸ¥çœ‹æœåŠ¡çŠ¶æ€ |

**æœåŠ¡ç«¯å£ï¼š**

| æœåŠ¡ | ç«¯å£ | è¯´æ˜ |
|------|------|------|
| å‰ç«¯ | 8110 | Next.js åº”ç”¨ |
| åç«¯ | 8111 | FastAPI API |
| PostgreSQL | 8108 | æ•°æ®åº“ï¼ˆDockerå†…éƒ¨ï¼‰ |
| Redis | 8109 | ç¼“å­˜ï¼ˆDockerå†…éƒ¨ï¼‰ |

**è®¿é—®åœ°å€ï¼š**
- å‰ç«¯åº”ç”¨: http://localhost:8110
- åç«¯ API: http://localhost:8111
- API æ–‡æ¡£: http://localhost:8111/docs

---

### æ–¹å¼äºŒï¼šé Docker æ‰‹åŠ¨éƒ¨ç½²

é€‚åˆå¼€å‘è°ƒè¯•æˆ–æ— æ³•ä½¿ç”¨ Docker çš„ç¯å¢ƒã€‚

#### å‰ç½®è¦æ±‚

- **Node.js**: 20.x æˆ–æ›´é«˜ç‰ˆæœ¬
- **Python**: 3.11 æˆ–æ›´é«˜ç‰ˆæœ¬
- **PostgreSQL**: 16+
- **Redis**: 7+

#### æ­¥éª¤ 1ï¼šå®‰è£…æ•°æ®åº“

**æ–¹å¼Aï¼šä½¿ç”¨ Docker è¿è¡Œæ•°æ®åº“ï¼ˆæ¨èï¼‰**
```bash
# åªå¯åŠ¨æ•°æ®åº“ï¼Œä¸å¯åŠ¨åº”ç”¨
# æ³¨æ„: è¿™é‡Œä½¿ç”¨æ ‡å‡†ç«¯å£ï¼Œå¦‚æœè¦ä¸é¡¹ç›® docker-compose.yml ä¸€è‡´ï¼Œè¯·ä½¿ç”¨ 8108/8109
docker run -d --name postgres16 \
  -p 8108:5432 \
  -e POSTGRES_PASSWORD=postgres123 \
  -e POSTGRES_DB=asp_db \
  postgres:16-alpine

docker run -d --name redis7 \
  -p 8109:6379 \
  redis:7-alpine
```

**æ–¹å¼Bï¼šæœ¬åœ°å®‰è£…æ•°æ®åº“**
```bash
# macOS (Homebrew)
brew install postgresql@16 redis
brew services start postgresql@16
brew services start redis

createdb asp_db

# Ubuntu
sudo apt update
sudo apt install postgresql postgresql-contrib redis-server
sudo systemctl start postgresql redis-server
sudo -u postgres createdb asp_db
```

#### æ­¥éª¤ 2ï¼šé…ç½®åç«¯

```bash
cd backend

# åˆ›å»ºè™šæ‹Ÿç¯å¢ƒ
python -m venv .venv
source .venv/bin/activate  # Windows: .venv\Scripts\activate

# å®‰è£…ä¾èµ–
pip install -r requirements.txt

# åˆ›å»ºç¯å¢ƒå˜é‡æ–‡ä»¶
cat > .env << 'EOF'
# åº”ç”¨é…ç½®
APP_ENV=development
DEBUG=true

# æ•°æ®åº“ (ç«¯å£ç»Ÿä¸€ä½¿ç”¨ 8108/8109)
DATABASE_URL=postgresql+asyncpg://postgres:postgres123@localhost:8108/asp_db
REDIS_URL=redis://localhost:8109/0

# JWT è®¤è¯
JWT_SECRET=your-super-secret-key-change-in-production
JWT_EXPIRE_MINUTES=1440

# é˜¿é‡Œäº‘ç™¾ç‚¼ (å¿…å¡«)
DASHSCOPE_API_KEY=sk-xxx
DASHSCOPE_MODEL=qwen3-max
REALTIME_MODEL=qwen-omni-turbo-latest
REALTIME_VOICE=Cherry
EOF

# åˆ›å»ºæ•°æ®åº“è¡¨
python -c "
import asyncio
from app.db.session import engine
from app.db.base import Base
import app.models

async def create_tables():
    async with engine.begin() as conn:
        await conn.run_sync(Base.metadata.create_all)
    print('Tables created!')

asyncio.run(create_tables())
"

# åˆ›å»ºç®¡ç†å‘˜è´¦å·
python -c "
import asyncio
from sqlalchemy.ext.asyncio import create_async_engine, AsyncSession
from sqlalchemy.orm import sessionmaker
from sqlalchemy import select
from app.config import settings
from app.core.security import get_password_hash
from app.models.user import User

async def create_admin():
    engine = create_async_engine(settings.database_url)
    async_session = sessionmaker(engine, class_=AsyncSession, expire_on_commit=False)
    async with async_session() as db:
        result = await db.execute(select(User).where(User.phone == '13800000000'))
        if not result.scalar_one_or_none():
            db.add(User(phone='13800000000', hashed_password=get_password_hash('admin123'), nickname='ç®¡ç†å‘˜', role='admin', track='sales', level='expert'))
            await db.commit()
            print('Admin created: 13800000000 / admin123')
        else:
            print('Admin already exists')

asyncio.run(create_admin())
"

# åˆå§‹åŒ–åœºæ™¯æ•°æ®
python -m scripts.seed_scenarios_full

# å¯åŠ¨åç«¯æœåŠ¡
uvicorn app.main:app --reload --host 0.0.0.0 --port 8111
```

#### æ­¥éª¤ 3ï¼šé…ç½®å‰ç«¯

```bash
cd frontend

# å®‰è£…ä¾èµ–
npm install

# åˆ›å»ºç¯å¢ƒå˜é‡æ–‡ä»¶
echo "NEXT_PUBLIC_API_URL=/api/v1" > .env.local

# å¼€å‘æ¨¡å¼å¯åŠ¨
npm run dev

# æˆ–ç”Ÿäº§æ¨¡å¼
npm run build
npm run start
```

#### æ­¥éª¤ 4ï¼šéªŒè¯éƒ¨ç½²

```bash
# æ£€æŸ¥åç«¯å¥åº·çŠ¶æ€
curl http://localhost:8111/health

# æ£€æŸ¥å‰ç«¯
curl http://localhost:8110

# æµ‹è¯•ç™»å½•
curl -X POST http://localhost:8111/api/v1/auth/login \
  -H "Content-Type: application/json" \
  -d '{"phone":"13800000000","password":"admin123"}'
```

---

### æ–¹å¼ä¸‰ï¼šCDN éƒ¨ç½² (EdgeOne/Cloudflare)

å¦‚æœä½ ä½¿ç”¨ CDN åŠ é€Ÿå‰ç«¯ï¼Œéœ€è¦ç‰¹åˆ«æ³¨æ„ WebSocket å’Œç¼“å­˜é…ç½®ã€‚

#### CDN ç¼“å­˜é…ç½®

å¤§å¤šæ•° CDN é»˜è®¤ä¼šç¼“å­˜æ‰€æœ‰å“åº”ï¼Œè¿™ä¼šå¯¼è‡´åŠ¨æ€é¡µé¢å’Œ API å‡ºç°é—®é¢˜ã€‚

**éœ€è¦é…ç½®ä¸ç¼“å­˜çš„è·¯å¾„ï¼š**

| è·¯å¾„ | è¯´æ˜ |
|------|------|
| `/api/*` | æ‰€æœ‰ API è¯·æ±‚ |
| `/dashboard/*` | ä»ªè¡¨ç›˜é¡µé¢ |
| `/admin/*` | åå°ç®¡ç†é¡µé¢ |
| `/training/*` | è®­ç»ƒé¡µé¢ |
| `/me/*` | ä¸ªäººä¸­å¿ƒ |
| `/vip/*` | VIP é¡µé¢ |
| `/login`, `/register` | ç™»å½•æ³¨å†Œé¡µé¢ |

**EdgeOne é…ç½®æ–¹æ³•ï¼š**
1. è¿›å…¥ EdgeOne æ§åˆ¶å° -> ç«™ç‚¹ç®¡ç† -> è§„åˆ™å¼•æ“
2. æ·»åŠ è§„åˆ™ï¼ŒåŒ¹é…è·¯å¾„ `/api/*`ï¼Œæ“ä½œé€‰æ‹©"ä¸ç¼“å­˜"
3. å¯¹å…¶ä»–åŠ¨æ€è·¯å¾„é‡å¤ä¸Šè¿°æ­¥éª¤

**Cloudflare é…ç½®æ–¹æ³•ï¼š**
1. è¿›å…¥ Cloudflare æ§åˆ¶å° -> è§„åˆ™ -> é¡µé¢è§„åˆ™
2. æ·»åŠ è§„åˆ™ `*yourdomain.com/api/*`ï¼Œè®¾ç½®"ç¼“å­˜çº§åˆ«"ä¸º"ç»•è¿‡"

#### WebSocket é…ç½® (é‡è¦)

**é—®é¢˜ï¼š** å¤§å¤šæ•° CDN (å¦‚ EdgeOneã€éƒ¨åˆ† Cloudflare é…ç½®) ä¸æ”¯æŒ WebSocket åè®®å‡çº§ï¼Œä¼šå¯¼è‡´å®æ—¶è¯­éŸ³å¯¹è¯åŠŸèƒ½æ— æ³•ä½¿ç”¨ã€‚

**è§£å†³æ–¹æ¡ˆï¼šåˆ›å»ºä¸“ç”¨ WebSocket åŸŸåç»•è¿‡ CDN**

1. **åˆ›å»ºå­åŸŸå**ï¼šè§£æä¸€ä¸ªæ–°åŸŸåç›´æ¥æŒ‡å‘æœåŠ¡å™¨ IPï¼ˆä¸ç»è¿‡ CDNï¼‰
   ```
   ws.yourdomain.com -> æœåŠ¡å™¨IP (Aè®°å½•ï¼Œä¸å¼€å¯CDNä»£ç†)
   ```

2. **é…ç½® Nginx åå‘ä»£ç†**ï¼ˆWebSocket ä¸“ç”¨åŸŸåï¼‰ï¼š
   ```nginx
   server {
       listen 80;
       listen 443 ssl http2;
       server_name ws.yourdomain.com;
       
       # SSL è¯ä¹¦é…ç½®
       ssl_certificate /path/to/fullchain.pem;
       ssl_certificate_key /path/to/privkey.pem;
       
       # WebSocket æ”¯æŒ
       location / {
           proxy_pass http://127.0.0.1:8111;
           proxy_http_version 1.1;
           proxy_set_header Upgrade $http_upgrade;
           proxy_set_header Connection "upgrade";
           proxy_set_header Host $http_host;
           proxy_set_header X-Real-IP $remote_addr;
           proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
           proxy_set_header X-Forwarded-Proto $scheme;
           
           # WebSocket è¶…æ—¶è®¾ç½® (10åˆ†é’Ÿ)
           proxy_connect_timeout 60s;
           proxy_send_timeout 600s;
           proxy_read_timeout 600s;
       }
   }
   ```

3. **ä¿®æ”¹å‰ç«¯ä»£ç **ï¼šåœ¨ `frontend/src/hooks/useRealtimeVoice.ts` ä¸­é…ç½® WebSocket åœ°å€
   ```typescript
   // æ–¹æ¡ˆ1: ä½¿ç”¨ç¯å¢ƒå˜é‡ (æ¨è)
   // åœ¨ frontend/.env.local ä¸­æ·»åŠ :
   // NEXT_PUBLIC_WS_URL=wss://ws.yourdomain.com/api/v1
   
   // æ–¹æ¡ˆ2: ç¡¬ç¼–ç åŸŸåæ˜ å°„ (å·²å†…ç½®)
   // ä»£ç ä¼šè‡ªåŠ¨æ£€æµ‹ä¸»åŸŸåå¹¶ä½¿ç”¨å¯¹åº”çš„ WebSocket åŸŸå
   const hostname = window.location.hostname;
   if (hostname === 'yourdomain.com') {
     return 'wss://ws.yourdomain.com/api/v1';
   }
   ```

4. **æ›´æ–° CORS é…ç½®**ï¼šåœ¨ `.env` ä¸­æ·»åŠ  WebSocket åŸŸå
   ```bash
   CORS_ORIGINS=https://yourdomain.com,https://ws.yourdomain.com,http://localhost:8110
   ```

5. **é‡æ–°éƒ¨ç½²**ï¼š
   ```bash
   ./deploy.sh rebuild
   ```

#### HTTPS é…ç½® (éº¦å…‹é£æƒé™å¿…éœ€)

æµè§ˆå™¨è¦æ±‚éº¦å…‹é£è®¿é—®å¿…é¡»åœ¨å®‰å…¨ä¸Šä¸‹æ–‡ (HTTPS) ä¸‹è¿›è¡Œã€‚

**æ–¹æ¡ˆAï¼šä½¿ç”¨ CDN æä¾›çš„ SSL**
- EdgeOne/Cloudflare ä¼šè‡ªåŠ¨ä¸ºä¸»åŸŸåæä¾› SSL
- WebSocket ä¸“ç”¨åŸŸåéœ€è¦å•ç‹¬ç”³è¯·è¯ä¹¦

**æ–¹æ¡ˆBï¼šä½¿ç”¨ Let's Encrypt å…è´¹è¯ä¹¦**
```bash
# å®‰è£… certbot
apt install certbot python3-certbot-nginx

# ç”³è¯·è¯ä¹¦
certbot --nginx -d yourdomain.com -d ws.yourdomain.com

# è‡ªåŠ¨ç»­æœŸ
certbot renew --dry-run
```

**æ–¹æ¡ˆCï¼šä½¿ç”¨å®å¡”é¢æ¿**
1. è¿›å…¥ç½‘ç«™ç®¡ç† -> SSL
2. é€‰æ‹© Let's Encrypt æˆ–ä¸Šä¼ è‡ªæœ‰è¯ä¹¦
3. å¼€å¯å¼ºåˆ¶ HTTPS

---

### ç”Ÿäº§ç¯å¢ƒé…ç½®

#### ç¯å¢ƒå˜é‡é…ç½®

ç”Ÿäº§ç¯å¢ƒè¯·åŠ¡å¿…ä¿®æ”¹ä»¥ä¸‹é…ç½®:

```bash
# åç«¯
APP_ENV=production
DEBUG=false
JWT_SECRET=<å¼ºéšæœºå­—ç¬¦ä¸²ï¼Œè‡³å°‘32ä½>
DATABASE_URL=<ç”Ÿäº§æ•°æ®åº“åœ°å€>
REDIS_URL=<ç”Ÿäº§Redisåœ°å€>
```

#### Nginx åå‘ä»£ç†é…ç½®

```nginx
server {
    listen 80;
    server_name yourdomain.com;

    # å‰ç«¯
    location / {
        proxy_pass http://localhost:8110;
        proxy_http_version 1.1;
        proxy_set_header Upgrade $http_upgrade;
        proxy_set_header Connection 'upgrade';
        proxy_set_header Host $host;
        proxy_cache_bypass $http_upgrade;
    }

    # åç«¯ API (é€šè¿‡å‰ç«¯ä»£ç†ï¼Œä¸éœ€è¦å•ç‹¬é…ç½®)
    # å‰ç«¯çš„ next.config.ts å·²é…ç½® rewrites å°† /api/* è½¬å‘åˆ°åç«¯
}
```

#### ä½¿ç”¨è¿›ç¨‹ç®¡ç†å™¨

```bash
# åç«¯ - ä½¿ç”¨ Gunicorn
pip install gunicorn
gunicorn app.main:app \
  --workers 4 \
  --worker-class uvicorn.workers.UvicornWorker \
  --bind 0.0.0.0:8111

# å‰ç«¯ - ä½¿ç”¨ PM2
npm install -g pm2
pm2 start npm --name "frontend" -- start
pm2 save
pm2 startup
```

---

## å¸¸è§é—®é¢˜

### 1. æ•°æ®åº“è¿æ¥å¤±è´¥

**é—®é¢˜**: `connection refused` æˆ– `could not connect to server`

**è§£å†³æ–¹æ¡ˆ**:
```bash
# æ£€æŸ¥ Docker æœåŠ¡æ˜¯å¦è¿è¡Œ
docker ps

# é‡å¯æ•°æ®åº“
make db

# æ£€æŸ¥ç«¯å£å ç”¨ (å¼€å‘ç¯å¢ƒä½¿ç”¨ 8108)
lsof -i :8108
```

### 2. å‰ç«¯æ— æ³•è¿æ¥åç«¯

**é—®é¢˜**: å‰ç«¯è¯·æ±‚è¿”å› `ERR_CONNECTION_REFUSED`

**è§£å†³æ–¹æ¡ˆ**:
- æ£€æŸ¥åç«¯æ˜¯å¦å¯åŠ¨: `curl http://localhost:8111/health`
- æ£€æŸ¥ `NEXT_PUBLIC_API_URL` ç¯å¢ƒå˜é‡
- æ£€æŸ¥ CORS é…ç½® (å¼€å‘ç¯å¢ƒåº”å…è®¸ `localhost:8110`)

### 3. è¿ç§»å¤±è´¥

**é—®é¢˜**: `alembic upgrade head` å¤±è´¥

**è§£å†³æ–¹æ¡ˆ**:
```bash
# æ£€æŸ¥æ•°æ®åº“è¿æ¥
cd backend
source .venv/bin/activate
python -c "from app.db.session import engine; print('OK')"

# é‡ç½®è¿ç§» (å±é™©æ“ä½œï¼ä»…å¼€å‘ç¯å¢ƒ)
alembic downgrade base
alembic upgrade head
```

### 4. å®æ—¶è¯­éŸ³æ— æ³•è¿æ¥

**é—®é¢˜**: WebSocket è¿æ¥å¤±è´¥

**è§£å†³æ–¹æ¡ˆ**:
- æ£€æŸ¥ `DASHSCOPE_API_KEY` æ˜¯å¦é…ç½®
- æ£€æŸ¥ç½‘ç»œæ˜¯å¦èƒ½è®¿é—®é˜¿é‡Œäº‘æœåŠ¡
- æŸ¥çœ‹åç«¯æ—¥å¿—: `docker-compose logs -f backend`

### 5. npm install æ…¢

**è§£å†³æ–¹æ¡ˆ**: ä½¿ç”¨å›½å†…é•œåƒæº
```bash
npm config set registry https://registry.npmmirror.com
npm install
```

### 6. å¾®ä¿¡ç™»å½•é…ç½®

**é—®é¢˜**: å¾®ä¿¡ç™»å½•æŒ‰é’®æ˜¾ç¤º"æœªé…ç½®"

**è§£å†³æ–¹æ¡ˆ**:
1. å‰å¾€ [å¾®ä¿¡å¼€æ”¾å¹³å°](https://open.weixin.qq.com/) åˆ›å»ºç½‘ç«™åº”ç”¨
2. è·å– AppID å’Œ AppSecret
3. é…ç½®æˆæƒå›è°ƒåŸŸå (éœ€ä¸ `WECHAT_REDIRECT_URI` ä¸€è‡´)
4. åœ¨ `backend/.env` ä¸­é…ç½®:
```bash
WECHAT_APP_ID=your_app_id
WECHAT_APP_SECRET=your_app_secret
WECHAT_REDIRECT_URI=https://yourdomain.com/api/v1/auth/wechat/callback
```

**æ³¨æ„**: 
- å¼€å‘ç¯å¢ƒå¯ä½¿ç”¨ `http://localhost:8110/api/v1/auth/wechat/callback`
- ç”Ÿäº§ç¯å¢ƒå¿…é¡»ä½¿ç”¨ HTTPS å’Œå·²å¤‡æ¡ˆåŸŸå
- å¾®ä¿¡å…¬ä¼—å·æˆæƒéœ€è¦é¢å¤–é…ç½® `WECHAT_MP_APP_ID` å’Œ `WECHAT_MP_APP_SECRET`

### 7. CDN å¯¼è‡´é¡µé¢ç¼“å­˜é—®é¢˜

**é—®é¢˜**: ç™»å½•åé¡µé¢æ²¡ååº”ï¼Œåˆ·æ–°æ‰æ˜¾ç¤ºï¼›æˆ–è€…æ˜¾ç¤ºæ—§æ•°æ®

**åŸå› **: CDN ç¼“å­˜äº†åŠ¨æ€é¡µé¢

**è§£å†³æ–¹æ¡ˆ**:
1. åœ¨ CDN æ§åˆ¶å°é…ç½®è§„åˆ™ï¼Œå¯¹ `/api/*`ã€`/dashboard/*`ã€`/admin/*` ç­‰è·¯å¾„ä¸ç¼“å­˜
2. é¡¹ç›®å·²åœ¨ `next.config.ts` ä¸­é…ç½®äº† `Cache-Control: no-store` å“åº”å¤´
3. å¦‚æœ CDN å¿½ç•¥æºç«™å“åº”å¤´ï¼Œéœ€è¦åœ¨ CDN è§„åˆ™ä¸­å¼ºåˆ¶è®¾ç½®

### 8. WebSocket è¿æ¥å¤±è´¥ (é”™è¯¯ç  1006)

**é—®é¢˜**: å®æ—¶è¯­éŸ³å¯¹è¯æ— æ³•è¿æ¥ï¼Œæ§åˆ¶å°æ˜¾ç¤º `WebSocket connection failed: 1006`

**åŸå› **: CDN ä¸æ”¯æŒ WebSocket åè®®å‡çº§

**è§£å†³æ–¹æ¡ˆ**:
1. åˆ›å»ºä¸“ç”¨å­åŸŸåç›´æ¥æŒ‡å‘æœåŠ¡å™¨ (ä¸ç»è¿‡ CDN)
2. é…ç½® Nginx åå‘ä»£ç†æ”¯æŒ WebSocket
3. ä¿®æ”¹å‰ç«¯ä»£ç ä½¿ç”¨ä¸“ç”¨ WebSocket åŸŸå
4. è¯¦è§ [CDN éƒ¨ç½²](#æ–¹å¼ä¸‰cdn-éƒ¨ç½²-edgeonecloudflare) ç« èŠ‚

**å¿«é€Ÿæ’æŸ¥**:
```bash
# æµ‹è¯• WebSocket è¿æ¥ (éœ€è¦å®‰è£… wscat)
npm install -g wscat
wscat -c "wss://ws.yourdomain.com/api/v1/ws/health"

# æ£€æŸ¥ Nginx é…ç½®
nginx -t

# æŸ¥çœ‹åç«¯æ—¥å¿—
docker-compose logs -f backend | grep -i websocket
```

### 9. éº¦å…‹é£æƒé™è¢«æ‹’ç»

**é—®é¢˜**: ç‚¹å‡»è¯­éŸ³å¯¹è¯æç¤º"æ— æ³•è®¿é—®éº¦å…‹é£"

**åŸå› **: 
- æµè§ˆå™¨è¦æ±‚éº¦å…‹é£è®¿é—®å¿…é¡»åœ¨å®‰å…¨ä¸Šä¸‹æ–‡ (HTTPS) ä¸‹
- ç”¨æˆ·æœªæˆæƒéº¦å…‹é£æƒé™

**è§£å†³æ–¹æ¡ˆ**:
1. ç¡®ä¿ç½‘ç«™ä½¿ç”¨ HTTPS è®¿é—®
2. åœ¨æµè§ˆå™¨è®¾ç½®ä¸­å…è®¸éº¦å…‹é£æƒé™
3. å¼€å‘ç¯å¢ƒ `localhost` è¢«è§†ä¸ºå®‰å…¨ä¸Šä¸‹æ–‡ï¼Œæ— éœ€ HTTPS

---

## è´¡çŒ®æŒ‡å—

### å¼€å‘æµç¨‹

1. Fork æœ¬ä»“åº“
2. åˆ›å»ºç‰¹æ€§åˆ†æ”¯: `git checkout -b feature/your-feature`
3. æäº¤æ›´æ”¹: `git commit -m "feat: add your feature"`
4. æ¨é€åˆ†æ”¯: `git push origin feature/your-feature`
5. æäº¤ Pull Request

### æäº¤è§„èŒƒ

éµå¾ª [Conventional Commits](https://www.conventionalcommits.org/):

```
feat: æ–°åŠŸèƒ½
fix: ä¿®å¤ bug
docs: æ–‡æ¡£æ›´æ–°
style: ä»£ç æ ¼å¼è°ƒæ•´
refactor: é‡æ„
test: æµ‹è¯•ç›¸å…³
chore: æ„å»ºå·¥å…·ã€ä¾èµ–æ›´æ–°
```

### ä»£ç è§„èŒƒ

- åç«¯: éµå¾ª PEP 8ï¼Œä½¿ç”¨ Ruff æ£€æŸ¥
- å‰ç«¯: éµå¾ª Airbnb JavaScript Style Guide
- æäº¤å‰å¿…é¡»é€šè¿‡: `make lint` å’Œ `make test`

### æ–‡ä»¶å¤´éƒ¨æ¨¡æ¿

æ‰€æœ‰æ–°æ–‡ä»¶å¿…é¡»æ·»åŠ ä»¥ä¸‹æ³¨é‡Š:

```python
"""
å¼€å‘ï¼š<ä½ çš„ç§°å‘¼>
åŠŸèƒ½ï¼š<åŠŸèƒ½æè¿°>
ä½œç”¨ï¼š<ä½œç”¨è¯´æ˜>
åˆ›å»ºæ—¶é—´ï¼š<åˆ›å»ºæ—¥æœŸ>
æœ€åä¿®æ”¹ï¼š<ä¿®æ”¹æ—¥æœŸ>
"""
```

---

## è·¯çº¿å›¾

### v1.0 (åˆå§‹ç‰ˆæœ¬)

- [x] ç”¨æˆ·è®¤è¯ä¸æƒé™ç®¡ç†
- [x] åœºæ™¯å¯¹ç»ƒ (æ–‡å­—/è¯­éŸ³)
- [x] è®­ç»ƒæŠ¥å‘Šä¸è¯„åˆ†
- [x] ä»ªè¡¨ç›˜ç»Ÿè®¡
- [x] åŸºç¡€åå°ç®¡ç†

### v1.1 (2024-12 æ›´æ–°)

**åŠŸèƒ½æ–°å¢**:
- [x] ç™»å½•å®‰å…¨å¢å¼º (é™æµã€Tokené»‘åå•ã€ç™»å½•å†å²)
- [x] å¾®ä¿¡ç™»å½•é›†æˆ (æ‰«ç ç™»å½•ã€å…¬ä¼—å·æˆæƒ)
- [x] è®­ç»ƒå¹¿åœº (åœºæ™¯åˆ†äº«ã€ç‚¹èµã€æ”¶è—ã€Fork)
- [x] åˆ›ä½œè€…ä¸­å¿ƒ (åœºæ™¯å‘å¸ƒã€æ•°æ®ç»Ÿè®¡)

**UI/UX ä¼˜åŒ–**:
- [x] Toastæç¤ºç³»ç»Ÿ (æ›¿ä»£alert,æ”¯æŒsuccess/error/warning/info)
- [x] æ·±è‰²/æµ…è‰²ä¸»é¢˜é…è‰²ä¼˜åŒ– (çº¯é»‘#000/çº¯ç™½#fffåŸºè°ƒ)
- [x] ç»Ÿä¸€å“ç‰Œæ¸å˜ (è“#2563eb + ç»¿#10b981)
- [x] é«˜å¯¹æ¯”åº¦æ–‡å­— (WCAG AAAæ ‡å‡†,å¯¹æ¯”åº¦7.3:1)
- [x] ä¸»é¢˜åˆ‡æ¢ä¼˜åŒ– (é¦–é¡µbadgeã€åå°ç®¡ç†header)

**é”™è¯¯å¤„ç†å¢å¼º**:
- [x] æ™ºèƒ½401å¤„ç† (é¿å…éè®¤è¯é”™è¯¯å¯¼è‡´å¼ºåˆ¶ç™»å‡º)
- [x] ç»Ÿä¸€é”™è¯¯æç¤º (å‹å¥½çš„ç”¨æˆ·æ–‡æ¡ˆ)
- [x] åå°ç®¡ç†QueryClientä¿®å¤

**æŠ€æœ¯æ”¹è¿›**:
- [x] 23+å¤„ç»„ä»¶é¢œè‰²ç»Ÿä¸€ä¸ºCSSå˜é‡
- [x] ZustandçŠ¶æ€ç®¡ç†Toasté˜Ÿåˆ—
- [x] Framer Motionä¼˜é›…åŠ¨ç”»

### v1.2 (å½“å‰ç‰ˆæœ¬)

**VIPä¼šå‘˜ç³»ç»Ÿ**:
- [x] VIPå¥—é¤ç®¡ç† (CRUDã€å¯ç”¨/ç¦ç”¨)
- [x] å¤šè®¡è´¹å‘¨æœŸæ”¯æŒ (æœˆ/å­£/åŠå¹´/å¹´)
- [x] ä¼šå‘˜æƒç›Šé…ç½®
- [x] è®¢å•ç®¡ç†ç³»ç»Ÿ
- [x] ä¼šå‘˜è®¢é˜…é¡µé¢

**è¥é”€ç³»ç»Ÿ**:
- [x] ä¼˜æƒ åˆ¸ç®¡ç† (åˆ›å»º/å‘æ”¾/æ ¸é”€/ç»Ÿè®¡)
- [x] å…‘æ¢ç ç³»ç»Ÿ (æ‰¹é‡ç”Ÿæˆ/å…‘æ¢/æœ‰æ•ˆæœŸ)
- [x] æ¨å¹¿é‚€è¯·ç³»ç»Ÿ

**ç§¯åˆ†ç³»ç»Ÿ**:
- [x] ç§¯åˆ†è·å–è§„åˆ™é…ç½®
- [x] ç§¯åˆ†æ¶ˆè€—è§„åˆ™é…ç½®
- [x] ç§¯åˆ†ç­‰çº§ä½“ç³»
- [x] ç§¯åˆ†æ˜ç»†è®°å½•

**ç­¾åˆ°ç³»ç»Ÿ**:
- [x] æ¯æ—¥ç­¾åˆ°åŠŸèƒ½
- [x] è¿ç»­ç­¾åˆ°å¥–åŠ±
- [x] ç­¾åˆ°é…ç½®ç®¡ç†

**åå°ç®¡ç†å¢å¼º**:
- [x] æ•°æ®æ¦‚è§ˆä»ªè¡¨ç›˜ (å®æ—¶æŒ‡æ ‡ã€å¢é•¿è¶‹åŠ¿)
- [x] å¹¿åœºå®¡æ ¸ç®¡ç†
- [x] è®­ç»ƒè®¡åˆ’ç®¡ç†
- [x] æˆå°±å‹‹ç« é…ç½®
- [x] é€šçŸ¥ç®¡ç†ç³»ç»Ÿ
- [x] ç³»ç»Ÿè®¾ç½®æ¨¡å— (çŸ­ä¿¡/ç™»å½•/æ”¯ä»˜/ç§¯åˆ†/ç­¾åˆ°é…ç½®)

**éƒ¨ç½²ä¼˜åŒ–**:
- [x] Docker Compose v2 å…¼å®¹ (ç§»é™¤åºŸå¼ƒçš„versionå­—æ®µ)
- [x] EdgeOne CDN éƒ¨ç½²æ”¯æŒ
- [x] HTTPS é…ç½®æŒ‡å— (éº¦å…‹é£æƒé™éœ€è¦å®‰å…¨ä¸Šä¸‹æ–‡)

### v1.3 (è§„åˆ’ä¸­)

- [ ] å¤šè¯­è¨€æ”¯æŒ (i18n)
- [ ] ç§»åŠ¨ç«¯ App (React Native)
- [ ] ä¼ä¸šç‰ˆåŠŸèƒ½ (å›¢é˜Ÿç®¡ç†ã€æ•°æ®éš”ç¦»)
- [ ] AI æ¨¡å‹è‡ªå®šä¹‰ (æ”¯æŒæ›´å¤š LLM æä¾›å•†)
- [ ] æ•°æ®å¯¼å‡ºä¸åˆ†ææŠ¥è¡¨

---

## æŠ€æœ¯æ”¯æŒ

### æ–‡æ¡£

- [é¡¹ç›® Wiki](docs/)
- [API æ–‡æ¡£](http://localhost:8111/docs)
- [AGENTS.md](AGENTS.md) - AI Agent å¼€å‘æŒ‡å—
- [PRD æ–‡æ¡£](PRD_é”€å† ä¸ç¤¾æåŸ¹å…»ç³»ç»Ÿ.md)

### è”ç³»æ–¹å¼

- å¼€å‘è€…: Excellent
- é‚®ç®±: 11964948@qq.com
- é—®é¢˜åé¦ˆ: æäº¤ [GitHub Issue](issues)

---

## å¼€æºåè®®

æœ¬é¡¹ç›®é‡‡ç”¨ [MIT License](LICENSE) å¼€æºåè®®ã€‚

---

## è‡´è°¢

- **[Qoderå®˜ç½‘](https://qoder.ai)** - åˆ›æ„çµæ„Ÿçš„æ¥æº
- [FastAPI](https://fastapi.tiangolo.com/) - é«˜æ€§èƒ½ Python Web æ¡†æ¶
- [Next.js](https://nextjs.org/) - React ç”Ÿäº§çº§æ¡†æ¶
- [é˜¿é‡Œäº‘ç™¾ç‚¼](https://bailian.console.aliyun.com/) - AI æ¨¡å‹æœåŠ¡
- [Lucide](https://lucide.dev/) - ä¼˜é›…çš„å›¾æ ‡åº“

---

<div align="center">

**è®© AI æˆä¸ºä½ çš„èƒ½åŠ›å¢é•¿æ•™ç»ƒ**

Made with â¤ï¸ by Excellent

</div>
